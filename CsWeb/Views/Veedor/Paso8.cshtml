@model CapaDominio.EntidadesNegocio.Pasos8
@using System.Globalization
@using CapaServicios.Servicios

<div class="banner1">
    <img src="~/Content/img/Riav/Paso8.jpg" />
</div>
@using (Html.BeginForm("Paso8", "Veedor", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.HiddenFor(model => model.PasosId)
    @Html.HiddenFor(model => model.NombreObjeto)

    <div>
        <ul class="steps">
            <li data-step="1" class="active">
                <a href="@Url.Action("Paso1",  new {id = @Model.PasosId})">
                    <span class="step">1</span>
                </a>
            </li>
            <li data-step="2" class="active">
                <a href="@Url.Action("Paso2",  new {id = @Model.PasosId})">
                    <span class="step">2</span>
                </a>
            </li>
            <li data-step="3" class="active">
                <a href="@Url.Action("Paso3",  new {id = @Model.PasosId})">
                    <span class="step">3</span>
                </a>
            </li>
            <li data-step="4" class="active">
                <a href="@Url.Action("Paso4",  new {id = @Model.PasosId})">
                    <span class="step">4</span>
                </a>
            </li>
            <li data-step="5" class="active">
                <a href="@Url.Action("Paso5",  new {id = @Model.PasosId})">
                    <span class="step">5</span>
                </a>
            </li>
            <li data-step="6" class="active">
                <a href="@Url.Action("Paso6",  new {id = @Model.PasosId})">
                    <span class="step">6</span>
                </a>
            </li>
            <li data-step="7" class="active">
                <a href="@Url.Action("Paso7",  new {id = @Model.PasosId})">
                    <span class="step">7</span>
                </a>
            </li>
            <li data-step="8" class="active">
                <a href="@Url.Action("Paso8",  new {id = @Model.PasosId})">
                    <span class="step">8</span>
                </a>
            </li>
            <li data-step="9">
                <a href="@Url.Action("Paso9",  new {id = @Model.PasosId})">
                    <span class="step">9</span>
                </a>
            </li>

        </ul>
    </div>
    <br /><p>En este paso una vez entregado el informe de veeduría a la entidad pública responsable, se sugiere al grupo de veeduría, hacer seguimiento al mismo, esto con el fin centrar la atención en los hallazgos identificados a lo largo del ejercicio de seguimiento y vigilancia que adelantó la veeduría ciudadana, así mismo deben estar pendientes de las acciones que lleva a cabo la entidad pública responsable de la implementación, posterior a la entrega del informe.</p>
    <div class="form-vertical">

        @*<div class="col-lg-12 form-group">*@
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4> @Model.NombreObjeto</h4>
            </div>
            <div class="panel-body">

                <div class="col-md-6">
                    <a href="#" title=""></a>
                    @Html.LabelFor(model => model.NumeroInforme)
                    @Html.EditorFor(model => model.NumeroInforme, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.NumeroInforme, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-6">
                    <a href="#" title=""></a>
                    @Html.LabelFor(model => model.FechaCreado)
                    @Html.TextBoxFor(model => model.FechaCreado, null, htmlAttributes: new { @class = "form-control", type = "date" })
                    @Html.ValidationMessageFor(model => model.FechaCreado, "", new { @class = "text-danger" })
                </div>

                <div class="col-md-12">
                    <a href="#" title="Es la forma en que el ciudadano va a hacer seguimiento al informe, donde contempla, tiempos, entidades, y funcionarios para vigilar las acciones de la entidad pública responsable posterior a la entrega">
                        @Html.LabelFor(model => model.PlanSeguimiento)
                    </a>
                    @Html.EditorFor(model => model.PlanSeguimiento, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.PlanSeguimiento, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-12">
                    <a href="#" title="actividades y gestiones que va a llevar a cabo el grupo de veeduría para hacer seguimiento al informe, lo cual puede contemplar, mesas de trabajo, reuniones con los funcionarios responsables, asistencia a audiencias públicas de rendición de cuentas entre otros.">
                        @Html.LabelFor(model => model.AccionesDespuesSeguimiento)
                    </a>
                    @Html.EditorFor(model => model.AccionesDespuesSeguimiento, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.AccionesDespuesSeguimiento, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-12">
                    <a href="#" title="Son las fechas en que el grupo de veeduría define que va a llevar a cabo nuevas acciones o actividades para hacer seguimiento al informe.">
                        @Html.LabelFor(model => model.FechaProximoSeguimiento)
                    </a>
                    @Html.TextBoxFor(model => model.FechaProximoSeguimiento, null, htmlAttributes: new { @class = "form-control", type = "date" })
                    @Html.ValidationMessageFor(model => model.FechaProximoSeguimiento, "", new { @class = "text-danger" })
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <a href="@Url.Action("ProyectosVeedor")" class="btn btn-success btn-sm">@(ArchivoDeRecursos.BotonRegresar)</a>
                        <a href="#" id="btn" class="btn btn-success btn-sm"><span aria-hidden="true"></span>Agregar seguimiento</a>
                        <button class="btn btn-success btn-sm" type="submit">@(ArchivoDeRecursos.BotonGuardar)</button>
                        <a href="@Url.Action("Exp",new { id = Model.PasosId, paso=8 })" class="btn btn-success btn-sm">Descargar reporte</a>
                        <a href="@Url.Action("Paso9", new { id = Model.PasosId })" class="btn btn-success btn-sm">Siguiente paso</a>
                        <a href="~/Content/Doc/PASOS8.pdf" class="btn btn-primary btn-sm" target="_blank">Ayuda</a>
                    </div>
                </div>
                <br /> <br />
                <div id="divGrid" style="margin: 0px 0px 0">
                    <table id="grid-table"></table>
                    <div id="grid-pager"></div>
                </div>
            </div>
        </div>
    </div>
    
    @*</div>*@
}
@section Scripts {
    <script type="text/javascript">

            //$('input, select, textarea').on("keypress", function () {
            //    $input = $(this);
            //    setTimeout(function () {
            //        $input.val($input.val().toUpperCase());
            //    }, 50);
            //});


            $('input, select, textarea').on('keydown', function (e) {
                var keyCode = e.keyCode || e.which;
                if (e.keyCode === 13) {
                    e.preventDefault();
                    // $('input, select, textarea')[$('input, select, textarea').index(this) + 1].focus();
                }
            });

              $("#btn").click(function (e) {
        e.preventDefault();
        agregarReg();
    });

        function agregarReg() {
            if ($('#NumeroInforme').val() != "" && $('#PlanSeguimiento').val() != "") {
                $.ajax({
                    url: '@Url.Action("CrearPaso8")',
                    type: 'POST',
                    dataType: 'json',
                    data: { PasosId: $('#PasosId').val(), NumeroInforme: $('#NumeroInforme').val(), PlanSeguimiento: $('#PlanSeguimiento').val(), AccionesDespuesSeguimiento: $('#AccionesDespuesSeguimiento').val(), FechaProximoSeguimiento: $('#FechaProximoSeguimiento').val() },
                    success: function (data) {
                        $('#grid-table').trigger('reloadGrid'); $('#NumeroInforme').val(''); $('#PlanSeguimiento').val(''); $('#AccionesDespuesSeguimiento').val('');
                    },
                });
            }
    }
    </script>
}
@section GridSection {
    <script type="text/javascript">

           jQuery(function ($) {
                            var gridSelector = "#grid-table";
                            var pagerSelector = "#grid-pager";
                            //resize to fit page size
                            //$(window).on('resize.jqGrid', function () {
                            //    $(gridSelector).jqGrid('setGridWidth', $(".page-content").width());
                            //});

                            // esta instruccion para encajar en el panel y comentar las lineas de arriba.
                            $(window).resize(function () {
                                $targetGrid.setGridWidth($(gridSelector).parent().width()); //perhaps add padding calculation here?
                            });
                            //resize on sidebar collapse/expand
                            var parentColumn = $(gridSelector).closest('[class*="col-"]');
                            $(document).on('settings.ace.jqGrid', function (ev, eventName) {
                                if (eventName === 'sidebar_collapsed' || eventName === 'main_container_fixed') {
                                    //setTimeout is for webkit only to give time for DOM changes and then redraw!!!
                                    setTimeout(function () {
                                        $(gridSelector).jqGrid('setGridWidth', parentColumn.width());
                                    }, 0);
                                }
                            });
                            //replace icons with FontAwesome icons like above
                            function updatePagerIcons() {
                                var replacement =
                                {
                                    'ui-icon-seek-first': 'ace-icon fa fa-angle-double-left bigger-140',
                                    'ui-icon-seek-prev': 'ace-icon fa fa-angle-left bigger-140',
                                    'ui-icon-seek-next': 'ace-icon fa fa-angle-right bigger-140',
                                    'ui-icon-seek-end': 'ace-icon fa fa-angle-double-right bigger-140'
                                };
                                var temp = '.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon';
                                $(temp).each(function () {
                                    var icon = $(this);
                                    var $class = $.trim(icon.attr('class').replace('ui-icon', ''));
                                    if ($class in replacement) icon.attr('class', 'ui-icon ' + replacement[$class]);
                                });
                            }

                            function enableTooltips(table) {
                                $('.navtable .ui-pg-button').tooltip({ container: 'body' });
                                $(table).find('.ui-pg-div').tooltip({ container: 'body' });
                            }

                            $(document).one('ajaxloadstart.page', function () {
                                $(gridSelector).jqGrid('GridUnload');
                                $('.ui-jqdialog').remove();
                            });

     @*function formatUrl(cellValue) {

                return "<a href='@Url.Action("Paso8")/" + cellValue+ "'><u>Ver</u></a>";
            }*@

            jQuery(gridSelector).jqGrid({
                height: '100%',
                 url: '@Url.Action("ObtenerPaso8", new { id = Model.PasosId })',
                mtype: 'POST',
                datatype: "json",
                colNames: ['', 'Número Informe', 'Plan Seguimiento', 'Acciones', 'Próximo seguimiento'],
                colModel: [
                   { name: 'Pasos8Id', width: 1, align: "center",  },
                    { name: 'NumeroInforme', width: 150, align: "center",sortable: true },
                    { name: 'PlanSeguimiento', width: 280, sortable: true },
                    { name: 'AccionesDespuesSeguimiento', width: 250, sortable: true },
                    { name: 'FechaProximoSeguimiento', width: 200, sortable: true },
                    //{ name: 'Alerta', width: 200, sortable: true },
                ],
                viewrecords: true,
                rowNum: 10,
                rowList: [10, 20, 50, 100, 500],
                pager: pagerSelector,
                altRows: true,
                loadComplete: function () {
                    var table = this;
                    setTimeout(function () {
                        updatePagerIcons(table);
                        enableTooltips(table);
                    }, 0);
                }
            });
            $(window).triggerHandler('resize.jqGrid');//trigger window resize to make the grid get the correct size
        });

    </script>
}


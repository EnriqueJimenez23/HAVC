@model CapaDominio.EntidadesNegocio.Pasos
@using System.Globalization
@using CapaServicios.Servicios

<div class="banner1">
    <img src="~/Content/img/Riav/Paso5.jpg" />
</div>
@using (Html.BeginForm("Paso5", "Veedor", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.HiddenFor(model => model.PasosId)
    @Html.HiddenFor(model => model.NumPaso)
    @Html.HiddenFor(model => model.NombreObjeto)

    <div>
        <ul class="steps">
            <li data-step="1" class="active">
                <a href="@Url.Action("Paso1",  new {id = @Model.PasosId})">
                    <span class="step">1</span>
                </a>
            </li>
            <li data-step="2" class="active">
                <a href="@Url.Action("Paso2",  new {id = @Model.PasosId})">
                    <span class="step">2</span>
                </a>
            </li>
            <li data-step="3" class="active">
                <a href="@Url.Action("Paso3",  new {id = @Model.PasosId})">
                    <span class="step">3</span>
                </a>
            </li>
            <li data-step="4" class="active">
                <a href="@Url.Action("Paso4",  new {id = @Model.PasosId})">
                    <span class="step">4</span>
                </a>
            </li>
            <li data-step="5" class="active">
                <a href="@Url.Action("Paso5",  new {id = @Model.PasosId})">
                    <span class="step">5</span>
                </a>
            </li>
            <li data-step="6">
                <a href="@Url.Action("Paso6",  new {id = @Model.PasosId})">
                    <span class="step">6</span>
                </a>
            </li>
            <li data-step="7">
                <a href="@Url.Action("Paso7",  new {id = @Model.PasosId})">
                    <span class="step">7</span>
                </a>
            </li>
            <li data-step="8">
                <a href="@Url.Action("Paso8",  new {id = @Model.PasosId})">
                    <span class="step">8</span>
                </a>
            </li>
            <li data-step="9">
                <a href="@Url.Action("Paso9",  new {id = @Model.PasosId})">
                    <span class="step">9</span>
                </a>
            </li>

        </ul>
    </div>
    <br /><p>
        En este paso el veedor debe establecer las pautas que le van a permitir hacer seguimiento y evaluación al objeto de seguimiento y vigilancia que definió en el paso 1, estos criterios deben ser elaborados en consecuencia con las acciones, objetivos y resultados planeados por la entidad pública responsable de la ejecución del plan, programa o proyecto.<br />
        Los siguientes componentes hacen parte de la cadena de resultados que esta, es un modelo lógico que tiene la capacidad de relacionar los insumos, las actividades planeadas, los cuales se transforman en productos y además de esto los resultados e impactos que se espera lograr como consecuencia de la generación de dichos productos.
    </p>
    <div class="form-vertical">

        @*<div class="col-lg-12 form-group">*@
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>    @Model.NombreObjeto</h4>
            </div>
            <div class="panel-body">

                <div class="col-md-12">
                    <a href="#" title="Efectos o cambios en el bienestar de manera permanente ">
                        @Html.LabelFor(model => model.Impactos)
                    </a>
                    @Html.EditorFor(model => model.Impactos, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Impactos, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-12">
                    <a href="#" title="Efectos o cambios en el bienestar a corto y mediano plazo ">
                        @Html.LabelFor(model => model.Resultados)
                    </a>
                    @Html.EditorFor(model => model.Resultados, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Resultados, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-12">
                    <a href="#" title="Bienes y servicios entregados a los beneficiaros de las comunidades">
                        @Html.LabelFor(model => model.Productos)
                    </a>
                    @Html.EditorFor(model => model.Productos, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Productos, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-12">
                    <a href="#" title="Las diferentes gestiones para transformar los recursos en productos">
                        @Html.LabelFor(model => model.Actividades)
                    </a>
                    @Html.EditorFor(model => model.Actividades, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Actividades, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-12">
                    <a href="#" title="Recursos financieros materiales e inmateriales (humanos).">
                        @Html.LabelFor(model => model.Insumos)
                    </a>
                    @Html.EditorFor(model => model.Insumos, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Insumos, "", new { @class = "text-danger" })
                </div>

                <div class="ibox-content">
                    <h2>Criterios de evaluación</h2>
                    <div class="row">
                        <div class="col-sm-8 form-group">
                            @Html.Label("Objetivo:")
                            @Html.Editor("Objetivo", new { htmlAttributes = new { @class = "form-control" } })
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-8 form-group">
                            @Html.Label("Evaluación cualitativa:")
                            @Html.Editor("Evaluacion", new { htmlAttributes = new { @class = "form-control" } })
                        </div>
                        <div class="col-sm-2 form-group">
                            @Html.Label("Cumple:")
                            @Html.DropDownList("Cumple", (IEnumerable<SelectListItem>)ViewBag.ListaSiNo, new { @class = "form-control" })
                        </div>


                        <div class="col-sm-2 form-group">
                            <a href="#" id="btn" class="btn btn-success btn-sm">
                                <span aria-hidden="true"></span>Agregar indicador
                            </a>
                        </div>

                    </div>

                </div>
            </div> <div class="ibox-title">

            </div>
            <div class="row">
                <div class="col-sm-12">

                    <a href="@Url.Action("ProyectosVeedor")" class="btn btn-success btn-sm">@(ArchivoDeRecursos.BotonRegresar)</a>
                    <button class="btn btn-success btn-sm" type="submit">@(ArchivoDeRecursos.BotonGuardar)</button>
                    <a href="@Url.Action("ExP5",new { id = Model.PasosId })" class="btn btn-success btn-sm">Descargar reporte</a>
                    <a href="@Url.Action("Paso6", new { id = Model.PasosId })" class="btn btn-success btn-sm">Siguiente paso</a>
                    <a href="~/Content/Doc/PASOS5.pdf" class="btn btn-primary btn-sm" target="_blank">Ayuda</a>
                    <br /><br />
                </div>
            </div>
            <div id="divGrid" style="margin: 0px 0 0px 0">
                <table id="grid-table"></table>
                <div id="grid-pager"></div>
            </div>
        </div>
    </div>
   
    @*</div>*@
}
@section Scripts {
    <script type="text/javascript">

            //$('input, select, textarea').on("keypress", function () {
            //    $input = $(this);
            //    setTimeout(function () {
            //        $input.val($input.val().toUpperCase());
            //    }, 50);
            //});


            $('input, select, textarea').on('keydown', function (e) {
                var keyCode = e.keyCode || e.which;
                if (e.keyCode === 13) {
                    e.preventDefault();
                    // $('input, select, textarea')[$('input, select, textarea').index(this) + 1].focus();
                }
            });
               $("#btn").click(function (e) {
        e.preventDefault();
        agregarReg();
    });

        function agregarReg() {
            if ($('#Objetivo').val() != "" && $('#Evaluacion').val() != "") {
                $.ajax({
                    url: '@Url.Action("CrearPaso5")',
                    type: 'POST',
                    dataType: 'json',
                    data: { PasosId: $('#PasosId').val(), ObjetivoProyecto: $('#Objetivo').val(), EvaluacionCualitativa: $('#Evaluacion').val(), Cumple: $('#Cumple').val(), },
                    success: function (data) {
                        $('#grid-table').trigger('reloadGrid'); $('#Objetivo').val(''); $('#Evaluacion').val('');

                    },
                });
            }
        }

    </script>
}


@section GridSection {
    <script type="text/javascript">

           jQuery(function ($) {
                            var gridSelector = "#grid-table";
                            var pagerSelector = "#grid-pager";
                            //resize to fit page size
                            $(window).on('resize.jqGrid', function () {
                                $(gridSelector).jqGrid('setGridWidth', $(".page-content").width());
                            });

                            // esta instruccion para encajar en el panel y comentar las lineas de arriba.
                            //$(window).resize(function () {
                            //    $targetGrid.setGridWidth($(gridSelector).parent().width()); //perhaps add padding calculation here?
                            //});
                            //resize on sidebar collapse/expand
                            var parentColumn = $(gridSelector).closest('[class*="col-"]');
                            $(document).on('settings.ace.jqGrid', function (ev, eventName) {
                                if (eventName === 'sidebar_collapsed' || eventName === 'main_container_fixed') {
                                    //setTimeout is for webkit only to give time for DOM changes and then redraw!!!
                                    setTimeout(function () {
                                        $(gridSelector).jqGrid('setGridWidth', parentColumn.width());
                                    }, 0);
                                }
                            });
                            //replace icons with FontAwesome icons like above
                            function updatePagerIcons() {
                                var replacement =
                                {
                                    'ui-icon-seek-first': 'ace-icon fa fa-angle-double-left bigger-140',
                                    'ui-icon-seek-prev': 'ace-icon fa fa-angle-left bigger-140',
                                    'ui-icon-seek-next': 'ace-icon fa fa-angle-right bigger-140',
                                    'ui-icon-seek-end': 'ace-icon fa fa-angle-double-right bigger-140'
                                };
                                var temp = '.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon';
                                $(temp).each(function () {
                                    var icon = $(this);
                                    var $class = $.trim(icon.attr('class').replace('ui-icon', ''));
                                    if ($class in replacement) icon.attr('class', 'ui-icon ' + replacement[$class]);
                                });
                            }

                            function enableTooltips(table) {
                                $('.navtable .ui-pg-button').tooltip({ container: 'body' });
                                $(table).find('.ui-pg-div').tooltip({ container: 'body' });
                            }

                            $(document).one('ajaxloadstart.page', function () {
                                $(gridSelector).jqGrid('GridUnload');
                                $('.ui-jqdialog').remove();
                            });

     function formatUrl(cellValue) {

               // return "<a href='@Url.Action("Eliminar5")/" + cellValue+ "'><u>Eliminar/u></a>";
            }

            jQuery(gridSelector).jqGrid({
                height: '100%',
                 url: '@Url.Action("ObtenerPaso5", new { id = Model.PasosId })',
                mtype: 'POST',
                datatype: "json",
                colNames: ['', 'Objetivo', 'Evaluación cualitativa','Cumple'],
                colModel: [
                   { name: 'Pasos5Id', width: 1, },
                    { name: 'ObjetivoProyecto', width: 250, sortable: true },
                    { name: 'EvaluacionCualitativa', width: 250, sortable: true },
                    { name: 'Cumple', width: 100, sortable: true },
                ],
                viewrecords: true,
                rowNum: 10,
                rowList: [10, 20, 50, 100, 500],
                pager: pagerSelector,
                altRows: true,
                loadComplete: function () {
                    var table = this;
                    setTimeout(function () {
                        updatePagerIcons(table);
                        enableTooltips(table);
                    }, 0);
                }
            });
            $(window).triggerHandler('resize.jqGrid');//trigger window resize to make the grid get the correct size
        });

    </script>
}


